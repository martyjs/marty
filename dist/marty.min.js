!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Marty=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({"./index.js":[function(require,module,exports){var _=require("underscore");var state=require("./lib/state");var create=require("./lib/create");var Dispatcher=require("./lib/dispatcher");var Marty=_.extend({version:"0.7.5",Dispatcher:Dispatcher.getCurrent()},state,create);module.exports=Marty},{"./lib/create":12,"./lib/dispatcher":14,"./lib/state":18,underscore:34}],1:[function(require,module,exports){var constants=require("./index");module.exports=constants(["ACTION_STARTING","ACTION_DONE","ACTION_FAILED"])},{"./index":2}],2:[function(require,module,exports){module.exports=require("../lib/constants")},{"../lib/constants":11}],3:[function(require,module,exports){var constants=require("./index");module.exports=constants(["PENDING","FAILED","DONE"])},{"./index":2}],4:[function(require,module,exports){function ActionHandlerNotFoundError(actionHandler,store){this.name="Action handler not found";this.message='The action handler "'+actionHandler+'" could not be found';if(store&&store.name){this.message+=" in the "+store.name+" store"}}ActionHandlerNotFoundError.prototype=Error.prototype;module.exports=ActionHandlerNotFoundError},{}],5:[function(require,module,exports){function ActionPredicateUndefinedError(actionHandler,store){this.name="Action predicate undefined";this.message='The action predicate for "'+actionHandler+'" was undefined';if(store&&store.name){this.message+=" in the "+store.name+" store"}}ActionPredicateUndefinedError.prototype=Error.prototype;module.exports=ActionPredicateUndefinedError},{}],6:[function(require,module,exports){function CompoundError(errors){this.errors=errors;this.name="Compound error"}CompoundError.prototype=Error.prototype;module.exports=CompoundError},{}],7:[function(require,module,exports){function NotFoundError(message){this.name="Not found";this.message=message||"";this.status=404}NotFoundError.prototype=Error.prototype;module.exports=NotFoundError},{}],8:[function(require,module,exports){function UnkownStoreError(store){this.name="Unknown store";this.message="Unknown store "+store}UnkownStoreError.prototype=Error.prototype;module.exports=UnkownStoreError},{}],9:[function(require,module,exports){var _=require("underscore");var uuid=require("./utils/uuid");var Dispatcher=require("./dispatcher");var ActionPayload=require("./actionPayload");var ActionConstants=require("../constants/actions");var serializeError=require("./utils/serializeError");function ActionCreators(options){var creator=this;var dispatcher=options.dispatcher||Dispatcher.getCurrent();options||(options={});this.getActionType=getActionType;_.extend.apply(_,[this,wrapFunctions(options)].concat(options.mixins));function getActionType(name){return name.replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[-\s]+/g,"_").toUpperCase()}function wrapFunctions(functions){_.each(functions,function(func,name){var actionType;var properties={};if(_.isFunction(func)){if(func.properties){if(!func.properties.type){throw new Error("Unknown action type")}actionType=func.properties.type;properties=_.omit(func.properties,"type")}else{actionType=creator.getActionType(name)}}else{return}functions[name]=function(){var result;var handlers=[];var actionId=uuid.small();dispatchStarting();try{result=func.apply(actionContext(),arguments);if(result){if(_.isFunction(result.then)){result.then(dispatchDone,dispatchError)}else{dispatchDone()}}else{dispatchDone()}return result}catch(e){dispatchError(e);throw e}function actionContext(){return _.extend({dispatch:function(){return dispatch({type:actionType,handlers:handlers,arguments:arguments},properties)}},creator)}function dispatchStarting(){dispatch({verbose:true,type:actionType+"_STARTING",arguments:[{id:actionId}]},properties);dispatch({verbose:true,type:ActionConstants.ACTION_STARTING,arguments:[{id:actionId,type:actionType,handlers:handlers,properties:properties}]},properties)}function dispatchDone(){dispatch({verbose:true,type:actionType+"_DONE",arguments:[{id:actionId,handlers:handlers}]},properties);dispatch({verbose:true,type:ActionConstants.ACTION_DONE,arguments:[{id:actionId,handlers:handlers}]},properties)}function dispatchError(err){err=serializeError(err);dispatch({verbose:true,type:actionType+"_FAILED",arguments:[{error:err,id:actionId,handlers:handlers}]},properties);dispatch({verbose:true,type:ActionConstants.ACTION_FAILED,arguments:[{error:err,id:actionId,handlers:handlers}]},properties)}}});return functions}function dispatch(payload,properties){var action=new ActionPayload(_.extend({},properties,payload));dispatcher.dispatch(action);return action}}module.exports=ActionCreators},{"../constants/actions":1,"./actionPayload":10,"./dispatcher":14,"./utils/serializeError":21,"./utils/uuid":22,underscore:34}],10:[function(require,module,exports){var _=require("underscore");var uuid=require("./utils/uuid");var cloneState=require("./utils/cloneState");var StatusConstants=require("../constants/status");function ActionPayload(options){options||(options={});var rollbackHandlers=[];var status=StatusConstants.PENDING;var handlers=options.handlers||[];_.extend(this,options);this.id=options.id||uuid.small();this.type=actionType(options.type);this.arguments=_.toArray(options.arguments);this.toJSON=toJSON;this.toString=toString;this.rollback=rollback;this.verbose=!!options.verbose;this.addViewHandler=addViewHandler;this.addStoreHandler=addStoreHandler;this.addRollbackHandler=addRollbackHandler;this.timestamp=options.timestamp||new Date;Object.defineProperty(this,"handlers",{get:function(){return handlers}});Object.defineProperty(this,"status",{get:function(){return status}});Object.defineProperty(this,"pending",{get:function(){return status===StatusConstants.PENDING}});Object.defineProperty(this,"failed",{get:function(){return status===StatusConstants.FAILED}});Object.defineProperty(this,"done",{get:function(){return status===StatusConstants.DONE}});function actionType(type){if(_.isFunction(type)){return type.toString()}return type}function toString(){return JSON.stringify(this.toJSON(),null,2)}function toJSON(){var json=_.pick(this,"id","type","source","creator","verbose","handlers","arguments","timestamp");json.status=this.status.toString();return json}function rollback(){_.each(rollbackHandlers,function(rollback){rollback()})}function addViewHandler(name,view,lastState){var storeHandler=handlers[handlers.length-1];var viewHandler={name:name,error:null,id:uuid.small(),state:{after:null,before:lastState}};storeHandler.views.push(viewHandler);return{dispose:function(){viewHandler.state.after=cloneState(view.state)},failed:function(err){viewHandler.error=err}}}function addStoreHandler(store,handlerName){var handler={views:[],error:null,type:"Store",id:uuid.small(),store:store.displayName,name:handlerName,state:{before:cloneState(store.getState()),after:undefined}};handlers.push(handler);return{dispose:function(){handler.state.after=cloneState(store.getState())},failed:function(err){handler.error=err}}}function addRollbackHandler(rollbackHandler,context){if(_.isFunction(rollbackHandler)){if(context){rollbackHandler=_.bind(rollbackHandler,context)}rollbackHandlers.push(rollbackHandler)}}}module.exports=ActionPayload},{"../constants/status":3,"./utils/cloneState":20,"./utils/uuid":22,underscore:34}],11:[function(require,module,exports){var _=require("underscore");function constants(obj){return toConstant(obj);function toConstant(obj){if(!obj){return{}}if(_.isArray(obj)){return arrayToConstants(obj)}if(_.isObject(obj)){return objectToConstants(obj)}}function objectToConstants(obj){return _.object(_.map(obj,valueToArray));function valueToArray(value,actionType){return[actionType,toConstant(value)]}}function arrayToConstants(array){return _.object(_.map(array,pair));function pair(actionType){return[actionType,createActionCreator(actionType)]}}function createActionCreator(actionType){var constantActionCreator=function(actionCreator,properties){if(!actionCreator){actionCreator=dispatchActionCreator}else if(!_.isFunction(actionCreator)){properties=actionCreator;actionCreator=dispatchActionCreator}actionCreator.properties=_.extend({},properties,{type:actionType});return actionCreator;function dispatchActionCreator(){this.dispatch.apply(this,arguments)}};constantActionCreator.type=actionType;constantActionCreator.isActionCreator=true;constantActionCreator.toString=function(){return actionType};return constantActionCreator}}module.exports=constants},{underscore:34}],12:[function(require,module,exports){var _=require("underscore");var Store=require("./store");var HttpAPI=require("./httpAPI");var constants=require("./constants");var Dispatcher=require("./dispatcher");var StateMixin=require("./mixins/stateMixin");var ActionCreators=require("./actionCreators");var EventEmitter=require("events").EventEmitter;var STORE_CHANGED_EVENT="store-changed";var stores=[];var emitter=new EventEmitter;module.exports={getStores:getStores,createStore:createStore,createHttpAPI:createHttpAPI,createHTTPAPI:createHttpAPI,createConstants:createConstants,createStateMixin:createStateMixin,createActionCreators:createActionCreators,addStoreChangeListener:addStoreChangeListener};function addStoreChangeListener(callback,context){if(context){callback=_.bind(callback,context)}emitter.on(STORE_CHANGED_EVENT,callback);return{dispose:function(){emitter.removeListener(STORE_CHANGED_EVENT,callback)}}}function getStores(){return stores}function createStore(options){var store=new Store(defaults(this,options));store.addChangeListener(onStoreChanged);stores.push(store);return store}function onStoreChanged(){var args=_.toArray(arguments);args.unshift(STORE_CHANGED_EVENT);emitter.emit.apply(emitter,args)}function createHttpAPI(options){return new HttpAPI(defaults(this,options))}function createConstants(obj){return constants(obj)}function createActionCreators(options){return new ActionCreators(defaults(this,options))}function createStateMixin(options){return new StateMixin(defaults(this,options))}function defaults(marty,options){options||(options={});if(!options.dispatcher){options.dispatcher=Dispatcher.getCurrent()}return options}},{"./actionCreators":9,"./constants":11,"./dispatcher":14,"./httpAPI":16,"./mixins/stateMixin":17,"./store":19,events:23,underscore:34}],13:[function(require,module,exports){var ACTION_STARTED="action-started";var EventEmitter=require("events").EventEmitter;var diagnosticEvents=new EventEmitter;var diagnostics={log:log,trace:log,warn:warn,enabled:false,onAction:onAction,dispatchingAction:dispatchingAction};module.exports=diagnostics;function dispatchingAction(action){diagnosticEvents.emit(ACTION_STARTED,action)}function log(){if(diagnostics.enabled){console.log.apply(console,arguments)}}function warn(){if(diagnostics.enabled){console.warn.apply(console,arguments)}}function onAction(callback){diagnosticEvents.on(ACTION_STARTED,callback);return{dispose:function(){diagnosticEvents.removeListener(ACTION_STARTED,callback)}}}},{events:23}],14:[function(require,module,exports){var uuid=require("./utils/uuid");var Dispatcher=require("flux").Dispatcher;var instance=new Dispatcher;instance.id=uuid.small();Dispatcher.getCurrent=function(){return instance};module.exports=Dispatcher},{"./utils/uuid":22,flux:29}],15:[function(require,module,exports){var NotFoundError=require("../errors/notFound");var StatusConstants=require("../constants/status");module.exports={done:done,failed:failed,pending:pending,notFound:notFound};function pending(){return fetchResult({pending:true,status:"PENDING"})}function failed(error){return fetchResult({error:error,failed:true,status:"FAILED"})}function done(result){return fetchResult({done:true,status:"DONE",result:result})}function notFound(){return failed(new NotFoundError)}function fetchResult(result){result.when=when;return result}function when(handlers){handlers||(handlers={});var status=this.status;var handler=handlers[status.toLowerCase()];if(!handler){throw new Error("Could not find a "+status+" handler")}switch(status){case StatusConstants.PENDING.toString():return handler.call(handlers);case StatusConstants.FAILED.toString():return handler.call(handlers,this.error);case StatusConstants.DONE.toString():return handler.call(handlers,this.result)}}},{"../constants/status":3,"../errors/notFound":7}],16:[function(require,module,exports){require("isomorphic-fetch");require("es6-promise").polyfill();var fetch=window.fetch;var _=require("underscore");var CONTENT_TYPE="Content-Type";var JSON_CONTENT_TYPE="application/json";function HttpAPI(options){options||(options={});_.extend(this,options)}_.extend(HttpAPI.prototype,{get:function(options){return this.request(requestOptions("GET",this.baseUrl,options))},put:function(options){return this.request(requestOptions("PUT",this.baseUrl,options))},post:function(options){return this.request(requestOptions("POST",this.baseUrl,options))},"delete":function(options){return this.request(requestOptions("DELETE",this.baseUrl,options))},request:function(options){if(!options.headers){options.headers={}}if(contentType()===JSON_CONTENT_TYPE&&_.isObject(options.body)){options.body=JSON.stringify(options.body);options.headers[CONTENT_TYPE]=JSON_CONTENT_TYPE}return fetch(options.url,options).then(function(res){if(isJson(res)){res.body=JSON.parse(res._body)}return res});function isJson(res){var contentTypes=getHeader(res,CONTENT_TYPE);_.isArray(contentTypes)||(contentTypes=[contentTypes]);return _.any(contentTypes,function(contentType){return contentType.indexOf(JSON_CONTENT_TYPE)!==-1})}function getHeader(res,name){return _.find(res.headers.map,function(value,key){return key.toLowerCase()===name.toLowerCase()})}function contentType(){return options.headers[CONTENT_TYPE]||JSON_CONTENT_TYPE}}});function requestOptions(method,baseUrl,options){if(_.isString(options)){options=_.extend({url:options})}options.method=method.toLowerCase();if(baseUrl){var separator="";var firstCharOfUrl=options.url[0];var lastCharOfBaseUrl=baseUrl[baseUrl.length-1];if(lastCharOfBaseUrl!=="/"&&firstCharOfUrl!=="/"){separator="/"}else if(lastCharOfBaseUrl==="/"&&firstCharOfUrl==="/"){options.url=options.url.substring(1)}options.url=baseUrl+separator+options.url}return options}module.exports=HttpAPI},{"es6-promise":28,"isomorphic-fetch":32,underscore:34}],17:[function(require,module,exports){var _=require("underscore");var uuid=require("../utils/uuid");var Diagnostics=require("../diagnostics");var cloneState=require("../utils/cloneState");var reservedKeys=["listenTo","getState","getInitialState"];function StateMixin(options){var config,instanceMethods;if(!options){throw new Error("The state mixin is expecting some options")}if(isStore(options)){config=storeMixinConfig(options)}else{config=simpleMixinConfig(options);instanceMethods=_.omit(options,reservedKeys)}var mixin=_.extend({onStoreChanged:function(state,store){Diagnostics.trace(store.displayName,"store has changed. The",this.displayName,"component ("+this._marty.id+") is updating");if(this._lifeCycleState==="UNMOUNTED"){Diagnostics.warn("Trying to set the state of ",this.displayName,"component ("+this._marty.id+") which is unmounted")}else{this.setState(this.tryGetState(store))}},tryGetState:function(store){var handler;if(store&&store.action){handler=store.action.addViewHandler(this.displayName,this,this._marty.lastState)}try{return this.getState()}catch(e){if(handler){handler.failed(e)}return{}}finally{if(handler){handler.dispose();this._marty.lastState=cloneState(this.state)}}},componentDidMount:function(){Diagnostics.trace("The",this.displayName,"component ("+this._marty.id+") has mounted.");this._marty.listeners=_.map(config.stores,function(store){Diagnostics.trace("The",this.displayName,"component  ("+this._marty.id+") is listening to the",store.displayName,"store");return store.addChangeListener(this.onStoreChanged)},this)},componentWillReceiveProps:function(nextProps){var oldProps=this.props;this.props=nextProps;var newState=this.getState();this.props=oldProps;this.setState(newState)},componentWillUnmount:function(){Diagnostics.trace("The",this.displayName,"component ("+this._marty.id+") is unmounting.","It is listening to",this._marty.listeners.length,"stores");_.each(this._marty.listeners,function(listener){listener.dispose()});this._marty.listeners=[]},getState:function(){return config.getState(this)},getInitialState:function(){var el=this._currentElement;if(!this.displayName&&el&&el.type){this.displayName=el.type.displayName}this.state={};this._marty={listeners:[],id:uuid.small(),lastState:undefined};if(options.getInitialState){this.state=options.getInitialState()}this.state=_.extend(this.state,this.getState());if(Diagnostics.enabled){this._marty.lastState=cloneState(this.state)}return this.state}},instanceMethods);return mixin;function storeMixinConfig(store){return{stores:[store],getState:function(){return store.getState()}}}function simpleMixinConfig(options){var stores=options.listenTo||[];var storesToGetStateFrom=findStoresToGetStateFrom(options);if(!_.isArray(stores)){stores=[stores]}if(!areStores(stores)){throw new Error("Can only listen to stores")}stores=stores.concat(_.values(storesToGetStateFrom));return{stores:stores,getState:getState};function getState(view){var state=_.object(_.map(storesToGetStateFrom,getStateFromStore));if(options.getState){state=_.extend(state,options.getState.call(view))}return state;function getStateFromStore(store,name){return[name,store.getState()]}}function findStoresToGetStateFrom(options){var storesToGetStateFrom={};_.each(options,function(value,key){if(reservedKeys.indexOf(key)===-1&&isStore(value)){storesToGetStateFrom[key]=value}});return storesToGetStateFrom}}function areStores(stores){for(var i=stores.length-1;i>=0;i--){if(!isStore(stores[i])){return false}}return true}function isStore(store){return store.getState&&store.addChangeListener}}module.exports=StateMixin},{"../diagnostics":13,"../utils/cloneState":20,"../utils/uuid":22,underscore:34}],18:[function(require,module,exports){var _=require("underscore");var UnknownStoreError=require("../errors/unknownStore");module.exports={setState:setState,clearState:clearState,serializeState:serializeState};function clearState(){_.each(this.getStores(),function(store){store.clear()})}function setState(states){var stores=indexByName(this.getStores());_.each(states,function(state,storeName){var store=stores[storeName];if(!store){throw new UnknownStoreError(storeName)}store.setState(state)});function indexByName(stores){return _.object(_.map(stores,function(store){return store.displayName}),stores)}}function serializeState(){var state={};_.each(this.getStores(),function(store){if(store.displayName){state[store.displayName]=(store.serialize||store.getState)()}});state.toString=function(){return"(window.__marty||(window.__marty={})).state="+JSON.stringify(state)};return state}},{"../errors/unknownStore":8,underscore:34}],19:[function(require,module,exports){var CHANGE_EVENT="changed";var _=require("underscore");var uuid=require("./utils/uuid");var fetchResult=require("./fetch");var Dispatcher=require("./dispatcher");var Diagnostics=require("./diagnostics");var CompoundError=require("../errors/compound");var NotFoundError=require("../errors/notFound");var EventEmitter=require("events").EventEmitter;var StatusConstants=require("../constants/status");var ActionHandlerNotFoundError=require("../errors/actionHandlerNotFound");var ActionPredicateUndefinedError=require("../errors/actionPredicateUndefined");var RESERVED_FUNCTIONS=["dispose","clear"];Store.defaultMaxListeners=1e7;function Store(options){var state;var store=this;var failedFetches={};var defaultState={};var fetchInProgress={};var emitter=new EventEmitter;var dispatcher=options.dispatcher||Dispatcher.getCurrent();this.handlers={};this.fetch=fetch;this.clear=clear;this.dispose=dispose;this.waitFor=waitFor;this.id=uuid.small();this.setState=setState;this.getState=getState;this.hasChanged=hasChanged;this.handleAction=handleAction;this.getInitialState=getInitialState;this.addChangeListener=addChangeListener;this.fetch.done=fetchResult.done;this.fetch.failed=fetchResult.failed;this.fetch.pending=fetchResult.pending;this.fetch.notFound=fetchResult.notFound;emitter.setMaxListeners(options.maxListeners||Store.defaultMaxListeners);extendStore(this,_.omit(options,RESERVED_FUNCTIONS));validateHandlers(this);this.dispatchToken=dispatcher.register(_.bind(this.handleAction,this));state=this.getInitialState();if(_.isNull(state)||_.isUndefined(state)){state=defaultState}Object.defineProperty(this,"state",{get:function(){return getState()},set:function(value){this.setState(value)}});function validateHandlers(store){_.each(store.handlers,function(actionPredicate,handlerName){var actionHandler=store[handlerName];if(_.isUndefined(actionHandler)||_.isNull(actionHandler)){throw new ActionHandlerNotFoundError(handlerName,store)}if(!actionPredicate){throw new ActionPredicateUndefinedError(handlerName,store)}})}function extendStore(store,options){var handlers=_.map(options.mixins,function(mixin){return mixin.handlers});var mixins=_.map(options.mixins,function(mixin){return _.omit(mixin,"handlers")});_.extend.apply(_,[store,options].concat(mixins));_.extend.apply(_,[store.handlers].concat(handlers))}function getInitialState(){return defaultState}function dispose(){emitter.removeAllListeners(CHANGE_EVENT);store.clear();if(_.isFunction(options.dispose)){options.dispose.call(store)}}function fetch(id,local,remote){var options,result,error,cacheError;if(_.isObject(id)){options=id}else{options={id:id,locally:local,remotely:remote}}if(!options||!options.id){throw new Error("must specify an id")}result=dependencyResult(options);if(result){return result}cacheError=_.isUndefined(options.cacheError)||options.cacheError;if(cacheError){error=failedFetches[options.id];if(error){return fetch.failed(error)}}if(fetchInProgress[options.id]){return fetch.pending()}return tryAndGetLocally()||tryAndGetRemotely();function tryAndGetLocally(){try{var result=options.locally.call(store);if(result){return fetch.done(result)}}catch(error){failedFetches[options.id]=error;return fetch.failed(error)}}function tryAndGetRemotely(){try{result=options.remotely.call(store);if(result){if(_.isFunction(result.then)){fetchInProgress[options.id]=true;result.then(function(){result=tryAndGetLocally();if(result){fetchFinished();hasChanged()}else{failed(new NotFoundError);hasChanged()}}).catch(function(error){failed(error);hasChanged()});return fetch.pending()}else{result=tryAndGetLocally();if(result){return result}}}return failed(new NotFoundError)}catch(error){return failed(error)}}function fetchFinished(){delete fetchInProgress[options.id]}function failed(error){if(cacheError){failedFetches[options.id]=error}fetchFinished();return fetch.failed(error)}}function dependencyResult(options){if(options.dependsOn){if(_.isArray(options.dependsOn)){var pending=false;var dependencyErrors=[];for(var i=0;i<options.dependsOn.length;i++){var dependency=options.dependsOn[i];switch(dependency.status){case StatusConstants.PENDING.toString():pending=true;break;case StatusConstants.FAILED.toString():dependencyErrors.push(dependency.error);break}}if(dependencyErrors.length){return fetch.failed(new CompoundError(dependencyErrors))}if(pending){return fetch.pending()}}else{if(!options.dependsOn.done){return options.dependsOn}}}}function clear(){failedFetches={};fetchInProgress={};store.state=store.getInitialState();if(_.isFunction(options.clear)){options.clear.call(store)}}function setState(newState){if(state!==newState){state=newState;store.hasChanged(state)}}function getState(){return state}function addChangeListener(callback,context){if(context){callback=_.bind(callback,context)}Diagnostics.trace("The",store.displayName,"store ("+store.id+") is adding a change listener");emitter.on(CHANGE_EVENT,callback);return{dispose:function(){Diagnostics.trace("The",store.displayName,"store ("+store.id+") is disposing of a change listener");emitter.removeListener(CHANGE_EVENT,callback)}}}function hasChanged(eventArgs){emitter.emit.call(emitter,CHANGE_EVENT,store.state,store,eventArgs)}function handleAction(action){var handlers=_.object(_.map(store.handlers,getHandlerWithPredicates));_.each(handlers,function(predicates,handlerName){_.each(predicates,function(predicate){if(predicate(action)){var rollbackHandler,actionHandler;var handler=action.addStoreHandler(this,handlerName,predicate.toJSON());try{this.action=action;actionHandler=this[handlerName];if(actionHandler){rollbackHandler=actionHandler.apply(this,action.arguments)}else{throw new ActionHandlerNotFoundError(handlerName,this)}}catch(e){handler.failed(e);throw e}finally{this.action=null;action.addRollbackHandler(rollbackHandler,this);if(handler){handler.dispose()}}}},this)},this);function getHandlerWithPredicates(actionPredicates,handler){_.isArray(actionPredicates)||(actionPredicates=[actionPredicates]);var predicates=_.map(actionPredicates,toFunc);return[handler,predicates];function toFunc(actionPredicate){if(actionPredicate.isActionCreator){actionPredicate={type:actionPredicate.toString()}}else if(_.isString(actionPredicate)){actionPredicate={type:actionPredicate}}var func=_.matches(actionPredicate);func.toJSON=function(){return actionPredicate};return func}}}function waitFor(stores){if(!_.isArray(stores)){stores=_.toArray(arguments)}dispatcher.waitFor(dispatchTokens(stores));function dispatchTokens(stores){var tokens=[];_.each(stores,function(store){if(store.dispatchToken){tokens.push(store.dispatchToken)}if(_.isString(store)){tokens.push(store)}});return tokens}}}module.exports=Store},{"../constants/status":3,"../errors/actionHandlerNotFound":4,"../errors/actionPredicateUndefined":5,"../errors/compound":6,"../errors/notFound":7,"./diagnostics":13,"./dispatcher":14,"./fetch":15,"./utils/uuid":22,events:23,underscore:34}],20:[function(require,module,exports){function cloneState(){return null}module.exports=cloneState},{}],21:[function(require,module,exports){function serializeError(error){if(!error){return null}var result={name:error.name};Object.getOwnPropertyNames(error).forEach(function(key){result[key]=error[key]});return result}module.exports=serializeError},{}],22:[function(require,module,exports){var format=require("util").format;function uuid(){return format("%s%s-%s-%s-%s-%s%s%s",s4(),s4(),s4(),s4(),s4(),s4(),s4(),s4())}function s4(){return Math.floor((1+Math.random())*65536).toString(16).substring(1)}module.exports={generate:uuid,small:function(){return uuid().substring(0,6)}}},{util:27}],23:[function(require,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}}else if(isObject(handler)){len=arguments.length;args=new Array(len-1);for(i=1;i<len;i++)args[i-1]=arguments[i];listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){var m;if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-->0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else{while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.listenerCount=function(emitter,type){var ret;if(!emitter._events||!emitter._events[type])ret=0;else if(isFunction(emitter._events[type]))ret=1;else ret=emitter._events[type].length;return ret};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}],24:[function(require,module,exports){if(typeof Object.create==="function"){module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;
ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],25:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=="undefined"&&window.setImmediate;var canPost=typeof window!=="undefined"&&window.postMessage&&window.addEventListener;if(canSetImmediate){return function(f){return window.setImmediate(f)}}if(canPost){var queue=[];window.addEventListener("message",function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==="process-tick"){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage("process-tick","*")}}return function nextTick(fn){setTimeout(fn,0)}}();process.title="browser";process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(dir){throw new Error("process.chdir is not supported")}},{}],26:[function(require,module,exports){module.exports=function isBuffer(arg){return arg&&typeof arg==="object"&&typeof arg.copy==="function"&&typeof arg.fill==="function"&&typeof arg.readUInt8==="function"}},{}],27:[function(require,module,exports){(function(process,global){var formatRegExp=/%[sdj%]/g;exports.format=function(f){if(!isString(f)){var objects=[];for(var i=0;i<arguments.length;i++){objects.push(inspect(arguments[i]))}return objects.join(" ")}var i=1;var args=arguments;var len=args.length;var str=String(f).replace(formatRegExp,function(x){if(x==="%%")return"%";if(i>=len)return x;switch(x){case"%s":return String(args[i++]);case"%d":return Number(args[i++]);case"%j":try{return JSON.stringify(args[i++])}catch(_){return"[Circular]"}default:return x}});for(var x=args[i];i<len;x=args[++i]){if(isNull(x)||!isObject(x)){str+=" "+x}else{str+=" "+inspect(x)}}return str};exports.deprecate=function(fn,msg){if(isUndefined(global.process)){return function(){return exports.deprecate(fn,msg).apply(this,arguments)}}if(process.noDeprecation===true){return fn}var warned=false;function deprecated(){if(!warned){if(process.throwDeprecation){throw new Error(msg)}else if(process.traceDeprecation){console.trace(msg)}else{console.error(msg)}warned=true}return fn.apply(this,arguments)}return deprecated};var debugs={};var debugEnviron;exports.debuglog=function(set){if(isUndefined(debugEnviron))debugEnviron=process.env.NODE_DEBUG||"";set=set.toUpperCase();if(!debugs[set]){if(new RegExp("\\b"+set+"\\b","i").test(debugEnviron)){var pid=process.pid;debugs[set]=function(){var msg=exports.format.apply(exports,arguments);console.error("%s %d: %s",set,pid,msg)}}else{debugs[set]=function(){}}}return debugs[set]};function inspect(obj,opts){var ctx={seen:[],stylize:stylizeNoColor};if(arguments.length>=3)ctx.depth=arguments[2];if(arguments.length>=4)ctx.colors=arguments[3];if(isBoolean(opts)){ctx.showHidden=opts}else if(opts){exports._extend(ctx,opts)}if(isUndefined(ctx.showHidden))ctx.showHidden=false;if(isUndefined(ctx.depth))ctx.depth=2;if(isUndefined(ctx.colors))ctx.colors=false;if(isUndefined(ctx.customInspect))ctx.customInspect=true;if(ctx.colors)ctx.stylize=stylizeWithColor;return formatValue(ctx,obj,ctx.depth)}exports.inspect=inspect;inspect.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]};inspect.styles={special:"cyan",number:"yellow","boolean":"yellow",undefined:"grey","null":"bold",string:"green",date:"magenta",regexp:"red"};function stylizeWithColor(str,styleType){var style=inspect.styles[styleType];if(style){return"["+inspect.colors[style][0]+"m"+str+"["+inspect.colors[style][1]+"m"}else{return str}}function stylizeNoColor(str,styleType){return str}function arrayToHash(array){var hash={};array.forEach(function(val,idx){hash[val]=true});return hash}function formatValue(ctx,value,recurseTimes){if(ctx.customInspect&&value&&isFunction(value.inspect)&&value.inspect!==exports.inspect&&!(value.constructor&&value.constructor.prototype===value)){var ret=value.inspect(recurseTimes,ctx);if(!isString(ret)){ret=formatValue(ctx,ret,recurseTimes)}return ret}var primitive=formatPrimitive(ctx,value);if(primitive){return primitive}var keys=Object.keys(value);var visibleKeys=arrayToHash(keys);if(ctx.showHidden){keys=Object.getOwnPropertyNames(value)}if(isError(value)&&(keys.indexOf("message")>=0||keys.indexOf("description")>=0)){return formatError(value)}if(keys.length===0){if(isFunction(value)){var name=value.name?": "+value.name:"";return ctx.stylize("[Function"+name+"]","special")}if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}if(isDate(value)){return ctx.stylize(Date.prototype.toString.call(value),"date")}if(isError(value)){return formatError(value)}}var base="",array=false,braces=["{","}"];if(isArray(value)){array=true;braces=["[","]"]}if(isFunction(value)){var n=value.name?": "+value.name:"";base=" [Function"+n+"]"}if(isRegExp(value)){base=" "+RegExp.prototype.toString.call(value)}if(isDate(value)){base=" "+Date.prototype.toUTCString.call(value)}if(isError(value)){base=" "+formatError(value)}if(keys.length===0&&(!array||value.length==0)){return braces[0]+base+braces[1]}if(recurseTimes<0){if(isRegExp(value)){return ctx.stylize(RegExp.prototype.toString.call(value),"regexp")}else{return ctx.stylize("[Object]","special")}}ctx.seen.push(value);var output;if(array){output=formatArray(ctx,value,recurseTimes,visibleKeys,keys)}else{output=keys.map(function(key){return formatProperty(ctx,value,recurseTimes,visibleKeys,key,array)})}ctx.seen.pop();return reduceToSingleString(output,base,braces)}function formatPrimitive(ctx,value){if(isUndefined(value))return ctx.stylize("undefined","undefined");if(isString(value)){var simple="'"+JSON.stringify(value).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return ctx.stylize(simple,"string")}if(isNumber(value))return ctx.stylize(""+value,"number");if(isBoolean(value))return ctx.stylize(""+value,"boolean");if(isNull(value))return ctx.stylize("null","null")}function formatError(value){return"["+Error.prototype.toString.call(value)+"]"}function formatArray(ctx,value,recurseTimes,visibleKeys,keys){var output=[];for(var i=0,l=value.length;i<l;++i){if(hasOwnProperty(value,String(i))){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,String(i),true))}else{output.push("")}}keys.forEach(function(key){if(!key.match(/^\d+$/)){output.push(formatProperty(ctx,value,recurseTimes,visibleKeys,key,true))}});return output}function formatProperty(ctx,value,recurseTimes,visibleKeys,key,array){var name,str,desc;desc=Object.getOwnPropertyDescriptor(value,key)||{value:value[key]};if(desc.get){if(desc.set){str=ctx.stylize("[Getter/Setter]","special")}else{str=ctx.stylize("[Getter]","special")}}else{if(desc.set){str=ctx.stylize("[Setter]","special")}}if(!hasOwnProperty(visibleKeys,key)){name="["+key+"]"}if(!str){if(ctx.seen.indexOf(desc.value)<0){if(isNull(recurseTimes)){str=formatValue(ctx,desc.value,null)}else{str=formatValue(ctx,desc.value,recurseTimes-1)}if(str.indexOf("\n")>-1){if(array){str=str.split("\n").map(function(line){return"  "+line}).join("\n").substr(2)}else{str="\n"+str.split("\n").map(function(line){return"   "+line}).join("\n")}}}else{str=ctx.stylize("[Circular]","special")}}if(isUndefined(name)){if(array&&key.match(/^\d+$/)){return str}name=JSON.stringify(""+key);if(name.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)){name=name.substr(1,name.length-2);name=ctx.stylize(name,"name")}else{name=name.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'");name=ctx.stylize(name,"string")}}return name+": "+str}function reduceToSingleString(output,base,braces){var numLinesEst=0;var length=output.reduce(function(prev,cur){numLinesEst++;if(cur.indexOf("\n")>=0)numLinesEst++;return prev+cur.replace(/\u001b\[\d\d?m/g,"").length+1},0);if(length>60){return braces[0]+(base===""?"":base+"\n ")+" "+output.join(",\n  ")+" "+braces[1]}return braces[0]+base+" "+output.join(", ")+" "+braces[1]}function isArray(ar){return Array.isArray(ar)}exports.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports.isBoolean=isBoolean;function isNull(arg){return arg===null}exports.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports.isUndefined=isUndefined;function isRegExp(re){return isObject(re)&&objectToString(re)==="[object RegExp]"}exports.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports.isObject=isObject;function isDate(d){return isObject(d)&&objectToString(d)==="[object Date]"}exports.isDate=isDate;function isError(e){return isObject(e)&&(objectToString(e)==="[object Error]"||e instanceof Error)}exports.isError=isError;function isFunction(arg){return typeof arg==="function"}exports.isFunction=isFunction;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports.isPrimitive=isPrimitive;exports.isBuffer=require("./support/isBuffer");function objectToString(o){return Object.prototype.toString.call(o)}function pad(n){return n<10?"0"+n.toString(10):n.toString(10)}var months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function timestamp(){var d=new Date;var time=[pad(d.getHours()),pad(d.getMinutes()),pad(d.getSeconds())].join(":");return[d.getDate(),months[d.getMonth()],time].join(" ")}exports.log=function(){console.log("%s - %s",timestamp(),exports.format.apply(exports,arguments))};exports.inherits=require("inherits");exports._extend=function(origin,add){if(!add||!isObject(add))return origin;var keys=Object.keys(add);var i=keys.length;while(i--){origin[keys[i]]=add[keys[i]]}return origin};function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./support/isBuffer":26,_process:25,inherits:24}],28:[function(require,module,exports){(function(process,global){(function(){"use strict";function $$utils$$objectOrFunction(x){return typeof x==="function"||typeof x==="object"&&x!==null}function $$utils$$isFunction(x){return typeof x==="function"}function $$utils$$isMaybeThenable(x){return typeof x==="object"&&x!==null}var $$utils$$_isArray;if(!Array.isArray){$$utils$$_isArray=function(x){return Object.prototype.toString.call(x)==="[object Array]"}}else{$$utils$$_isArray=Array.isArray}var $$utils$$isArray=$$utils$$_isArray;var $$utils$$now=Date.now||function(){return(new Date).getTime()};function $$utils$$F(){}var $$utils$$o_create=Object.create||function(o){if(arguments.length>1){throw new Error("Second argument not supported")}if(typeof o!=="object"){throw new TypeError("Argument must be an object")}$$utils$$F.prototype=o;return new $$utils$$F};var $$asap$$len=0;var $$asap$$default=function asap(callback,arg){$$asap$$queue[$$asap$$len]=callback;$$asap$$queue[$$asap$$len+1]=arg;$$asap$$len+=2;if($$asap$$len===2){$$asap$$scheduleFlush()}};var $$asap$$browserGlobal=typeof window!=="undefined"?window:{};var $$asap$$BrowserMutationObserver=$$asap$$browserGlobal.MutationObserver||$$asap$$browserGlobal.WebKitMutationObserver;var $$asap$$isWorker=typeof Uint8ClampedArray!=="undefined"&&typeof importScripts!=="undefined"&&typeof MessageChannel!=="undefined";function $$asap$$useNextTick(){return function(){process.nextTick($$asap$$flush)}}function $$asap$$useMutationObserver(){var iterations=0;var observer=new $$asap$$BrowserMutationObserver($$asap$$flush);var node=document.createTextNode("");observer.observe(node,{characterData:true});return function(){node.data=iterations=++iterations%2}}function $$asap$$useMessageChannel(){var channel=new MessageChannel;channel.port1.onmessage=$$asap$$flush;return function(){channel.port2.postMessage(0)}}function $$asap$$useSetTimeout(){return function(){setTimeout($$asap$$flush,1)}}var $$asap$$queue=new Array(1e3);function $$asap$$flush(){for(var i=0;i<$$asap$$len;i+=2){var callback=$$asap$$queue[i];var arg=$$asap$$queue[i+1];callback(arg);$$asap$$queue[i]=undefined;$$asap$$queue[i+1]=undefined}$$asap$$len=0}var $$asap$$scheduleFlush;if(typeof process!=="undefined"&&{}.toString.call(process)==="[object process]"){$$asap$$scheduleFlush=$$asap$$useNextTick()}else if($$asap$$BrowserMutationObserver){$$asap$$scheduleFlush=$$asap$$useMutationObserver()}else if($$asap$$isWorker){$$asap$$scheduleFlush=$$asap$$useMessageChannel()}else{$$asap$$scheduleFlush=$$asap$$useSetTimeout()}function $$$internal$$noop(){}var $$$internal$$PENDING=void 0;var $$$internal$$FULFILLED=1;var $$$internal$$REJECTED=2;var $$$internal$$GET_THEN_ERROR=new $$$internal$$ErrorObject;function $$$internal$$selfFullfillment(){return new TypeError("You cannot resolve a promise with itself")}function $$$internal$$cannotReturnOwn(){return new TypeError("A promises callback cannot return that same promise.")}function $$$internal$$getThen(promise){try{return promise.then}catch(error){$$$internal$$GET_THEN_ERROR.error=error;return $$$internal$$GET_THEN_ERROR}}function $$$internal$$tryThen(then,value,fulfillmentHandler,rejectionHandler){try{then.call(value,fulfillmentHandler,rejectionHandler)}catch(e){return e}}function $$$internal$$handleForeignThenable(promise,thenable,then){$$asap$$default(function(promise){var sealed=false;var error=$$$internal$$tryThen(then,thenable,function(value){if(sealed){return}sealed=true;if(thenable!==value){$$$internal$$resolve(promise,value)}else{$$$internal$$fulfill(promise,value)}},function(reason){if(sealed){return}sealed=true;$$$internal$$reject(promise,reason)},"Settle: "+(promise._label||" unknown promise"));if(!sealed&&error){sealed=true;$$$internal$$reject(promise,error)}},promise)}function $$$internal$$handleOwnThenable(promise,thenable){if(thenable._state===$$$internal$$FULFILLED){$$$internal$$fulfill(promise,thenable._result)}else if(promise._state===$$$internal$$REJECTED){$$$internal$$reject(promise,thenable._result)}else{$$$internal$$subscribe(thenable,undefined,function(value){$$$internal$$resolve(promise,value)},function(reason){$$$internal$$reject(promise,reason)})}}function $$$internal$$handleMaybeThenable(promise,maybeThenable){if(maybeThenable.constructor===promise.constructor){$$$internal$$handleOwnThenable(promise,maybeThenable)}else{var then=$$$internal$$getThen(maybeThenable);if(then===$$$internal$$GET_THEN_ERROR){$$$internal$$reject(promise,$$$internal$$GET_THEN_ERROR.error)}else if(then===undefined){$$$internal$$fulfill(promise,maybeThenable)}else if($$utils$$isFunction(then)){$$$internal$$handleForeignThenable(promise,maybeThenable,then)}else{$$$internal$$fulfill(promise,maybeThenable)}}}function $$$internal$$resolve(promise,value){if(promise===value){$$$internal$$reject(promise,$$$internal$$selfFullfillment())}else if($$utils$$objectOrFunction(value)){$$$internal$$handleMaybeThenable(promise,value)}else{$$$internal$$fulfill(promise,value)}}function $$$internal$$publishRejection(promise){if(promise._onerror){promise._onerror(promise._result)}$$$internal$$publish(promise)}function $$$internal$$fulfill(promise,value){if(promise._state!==$$$internal$$PENDING){return}promise._result=value;promise._state=$$$internal$$FULFILLED;if(promise._subscribers.length===0){}else{$$asap$$default($$$internal$$publish,promise)}}function $$$internal$$reject(promise,reason){if(promise._state!==$$$internal$$PENDING){return}promise._state=$$$internal$$REJECTED;promise._result=reason;$$asap$$default($$$internal$$publishRejection,promise)}function $$$internal$$subscribe(parent,child,onFulfillment,onRejection){var subscribers=parent._subscribers;var length=subscribers.length;parent._onerror=null;subscribers[length]=child;subscribers[length+$$$internal$$FULFILLED]=onFulfillment;subscribers[length+$$$internal$$REJECTED]=onRejection;if(length===0&&parent._state){$$asap$$default($$$internal$$publish,parent)}}function $$$internal$$publish(promise){var subscribers=promise._subscribers;var settled=promise._state;if(subscribers.length===0){return}var child,callback,detail=promise._result;for(var i=0;i<subscribers.length;i+=3){child=subscribers[i];callback=subscribers[i+settled];if(child){$$$internal$$invokeCallback(settled,child,callback,detail)}else{callback(detail)}}promise._subscribers.length=0}function $$$internal$$ErrorObject(){this.error=null}var $$$internal$$TRY_CATCH_ERROR=new $$$internal$$ErrorObject;function $$$internal$$tryCatch(callback,detail){try{return callback(detail)}catch(e){$$$internal$$TRY_CATCH_ERROR.error=e;return $$$internal$$TRY_CATCH_ERROR}}function $$$internal$$invokeCallback(settled,promise,callback,detail){var hasCallback=$$utils$$isFunction(callback),value,error,succeeded,failed;if(hasCallback){value=$$$internal$$tryCatch(callback,detail);if(value===$$$internal$$TRY_CATCH_ERROR){failed=true;error=value.error;value=null}else{succeeded=true}if(promise===value){$$$internal$$reject(promise,$$$internal$$cannotReturnOwn());return}}else{value=detail;succeeded=true}if(promise._state!==$$$internal$$PENDING){}else if(hasCallback&&succeeded){$$$internal$$resolve(promise,value)}else if(failed){$$$internal$$reject(promise,error)}else if(settled===$$$internal$$FULFILLED){$$$internal$$fulfill(promise,value)}else if(settled===$$$internal$$REJECTED){$$$internal$$reject(promise,value)}}function $$$internal$$initializePromise(promise,resolver){try{resolver(function resolvePromise(value){$$$internal$$resolve(promise,value)},function rejectPromise(reason){$$$internal$$reject(promise,reason)})}catch(e){$$$internal$$reject(promise,e)}}function $$$enumerator$$makeSettledResult(state,position,value){if(state===$$$internal$$FULFILLED){return{state:"fulfilled",value:value}}else{return{state:"rejected",reason:value}}}function $$$enumerator$$Enumerator(Constructor,input,abortOnReject,label){this._instanceConstructor=Constructor;this.promise=new Constructor($$$internal$$noop,label);this._abortOnReject=abortOnReject;if(this._validateInput(input)){this._input=input;this.length=input.length;this._remaining=input.length;this._init();if(this.length===0){$$$internal$$fulfill(this.promise,this._result)}else{this.length=this.length||0;this._enumerate();if(this._remaining===0){$$$internal$$fulfill(this.promise,this._result)}}}else{$$$internal$$reject(this.promise,this._validationError())}}$$$enumerator$$Enumerator.prototype._validateInput=function(input){return $$utils$$isArray(input)};$$$enumerator$$Enumerator.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")};$$$enumerator$$Enumerator.prototype._init=function(){this._result=new Array(this.length)};var $$$enumerator$$default=$$$enumerator$$Enumerator;$$$enumerator$$Enumerator.prototype._enumerate=function(){var length=this.length;var promise=this.promise;var input=this._input;for(var i=0;promise._state===$$$internal$$PENDING&&i<length;i++){this._eachEntry(input[i],i)}};$$$enumerator$$Enumerator.prototype._eachEntry=function(entry,i){var c=this._instanceConstructor;if($$utils$$isMaybeThenable(entry)){if(entry.constructor===c&&entry._state!==$$$internal$$PENDING){entry._onerror=null;this._settledAt(entry._state,i,entry._result)}else{this._willSettleAt(c.resolve(entry),i)}}else{this._remaining--;this._result[i]=this._makeResult($$$internal$$FULFILLED,i,entry)}};$$$enumerator$$Enumerator.prototype._settledAt=function(state,i,value){var promise=this.promise;if(promise._state===$$$internal$$PENDING){this._remaining--;if(this._abortOnReject&&state===$$$internal$$REJECTED){$$$internal$$reject(promise,value)}else{this._result[i]=this._makeResult(state,i,value)}}if(this._remaining===0){$$$internal$$fulfill(promise,this._result)}};$$$enumerator$$Enumerator.prototype._makeResult=function(state,i,value){return value};$$$enumerator$$Enumerator.prototype._willSettleAt=function(promise,i){var enumerator=this;$$$internal$$subscribe(promise,undefined,function(value){enumerator._settledAt($$$internal$$FULFILLED,i,value)},function(reason){enumerator._settledAt($$$internal$$REJECTED,i,reason)})};var $$promise$all$$default=function all(entries,label){return new $$$enumerator$$default(this,entries,true,label).promise};var $$promise$race$$default=function race(entries,label){var Constructor=this;var promise=new Constructor($$$internal$$noop,label);if(!$$utils$$isArray(entries)){$$$internal$$reject(promise,new TypeError("You must pass an array to race."));return promise}var length=entries.length;function onFulfillment(value){$$$internal$$resolve(promise,value)}function onRejection(reason){$$$internal$$reject(promise,reason)}for(var i=0;promise._state===$$$internal$$PENDING&&i<length;i++){$$$internal$$subscribe(Constructor.resolve(entries[i]),undefined,onFulfillment,onRejection)}return promise};var $$promise$resolve$$default=function resolve(object,label){var Constructor=this;if(object&&typeof object==="object"&&object.constructor===Constructor){return object}var promise=new Constructor($$$internal$$noop,label);$$$internal$$resolve(promise,object);return promise};var $$promise$reject$$default=function reject(reason,label){var Constructor=this;var promise=new Constructor($$$internal$$noop,label);$$$internal$$reject(promise,reason);return promise};var $$es6$promise$promise$$counter=0;function $$es6$promise$promise$$needsResolver(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function $$es6$promise$promise$$needsNew(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var $$es6$promise$promise$$default=$$es6$promise$promise$$Promise;function $$es6$promise$promise$$Promise(resolver){this._id=$$es6$promise$promise$$counter++;this._state=undefined;this._result=undefined;this._subscribers=[];if($$$internal$$noop!==resolver){if(!$$utils$$isFunction(resolver)){$$es6$promise$promise$$needsResolver()}if(!(this instanceof $$es6$promise$promise$$Promise)){$$es6$promise$promise$$needsNew()}$$$internal$$initializePromise(this,resolver)}}$$es6$promise$promise$$Promise.all=$$promise$all$$default;$$es6$promise$promise$$Promise.race=$$promise$race$$default;$$es6$promise$promise$$Promise.resolve=$$promise$resolve$$default;$$es6$promise$promise$$Promise.reject=$$promise$reject$$default;$$es6$promise$promise$$Promise.prototype={constructor:$$es6$promise$promise$$Promise,then:function(onFulfillment,onRejection){var parent=this;var state=parent._state;if(state===$$$internal$$FULFILLED&&!onFulfillment||state===$$$internal$$REJECTED&&!onRejection){return this}var child=new this.constructor($$$internal$$noop);var result=parent._result;if(state){var callback=arguments[state-1];$$asap$$default(function(){$$$internal$$invokeCallback(state,child,callback,result)})}else{$$$internal$$subscribe(parent,child,onFulfillment,onRejection)}return child},"catch":function(onRejection){return this.then(null,onRejection)}};var $$es6$promise$polyfill$$default=function polyfill(){var local;if(typeof global!=="undefined"){local=global}else if(typeof window!=="undefined"&&window.document){local=window}else{local=self}var es6PromiseSupport="Promise"in local&&"resolve"in local.Promise&&"reject"in local.Promise&&"all"in local.Promise&&"race"in local.Promise&&function(){var resolve;new local.Promise(function(r){resolve=r});return $$utils$$isFunction(resolve)}();if(!es6PromiseSupport){local.Promise=$$es6$promise$promise$$default}};var es6$promise$umd$$ES6Promise={Promise:$$es6$promise$promise$$default,polyfill:$$es6$promise$polyfill$$default};if(typeof define==="function"&&define["amd"]){define(function(){return es6$promise$umd$$ES6Promise})}else if(typeof module!=="undefined"&&module["exports"]){module["exports"]=es6$promise$umd$$ES6Promise}else if(typeof this!=="undefined"){this["ES6Promise"]=es6$promise$umd$$ES6Promise}}).call(this)}).call(this,require("_process"),typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{_process:25}],29:[function(require,module,exports){module.exports.Dispatcher=require("./lib/Dispatcher")},{"./lib/Dispatcher":30}],30:[function(require,module,exports){"use strict";var invariant=require("./invariant");var _lastID=1;var _prefix="ID_";function Dispatcher(){this.$Dispatcher_callbacks={};this.$Dispatcher_isPending={};this.$Dispatcher_isHandled={};this.$Dispatcher_isDispatching=false;this.$Dispatcher_pendingPayload=null}Dispatcher.prototype.register=function(callback){var id=_prefix+_lastID++;this.$Dispatcher_callbacks[id]=callback;return id};Dispatcher.prototype.unregister=function(id){invariant(this.$Dispatcher_callbacks[id],"Dispatcher.unregister(...): `%s` does not map to a registered callback.",id);delete this.$Dispatcher_callbacks[id]};Dispatcher.prototype.waitFor=function(ids){invariant(this.$Dispatcher_isDispatching,"Dispatcher.waitFor(...): Must be invoked while dispatching.");for(var ii=0;ii<ids.length;ii++){var id=ids[ii];if(this.$Dispatcher_isPending[id]){invariant(this.$Dispatcher_isHandled[id],"Dispatcher.waitFor(...): Circular dependency detected while "+"waiting for `%s`.",id);continue}invariant(this.$Dispatcher_callbacks[id],"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",id);this.$Dispatcher_invokeCallback(id)}};Dispatcher.prototype.dispatch=function(payload){invariant(!this.$Dispatcher_isDispatching,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch.");this.$Dispatcher_startDispatching(payload);try{for(var id in this.$Dispatcher_callbacks){if(this.$Dispatcher_isPending[id]){continue}this.$Dispatcher_invokeCallback(id)}}finally{this.$Dispatcher_stopDispatching()}};Dispatcher.prototype.isDispatching=function(){return this.$Dispatcher_isDispatching};Dispatcher.prototype.$Dispatcher_invokeCallback=function(id){this.$Dispatcher_isPending[id]=true;this.$Dispatcher_callbacks[id](this.$Dispatcher_pendingPayload);this.$Dispatcher_isHandled[id]=true};Dispatcher.prototype.$Dispatcher_startDispatching=function(payload){for(var id in this.$Dispatcher_callbacks){this.$Dispatcher_isPending[id]=false;this.$Dispatcher_isHandled[id]=false}this.$Dispatcher_pendingPayload=payload;this.$Dispatcher_isDispatching=true};Dispatcher.prototype.$Dispatcher_stopDispatching=function(){this.$Dispatcher_pendingPayload=null;this.$Dispatcher_isDispatching=false};module.exports=Dispatcher},{"./invariant":31}],31:[function(require,module,exports){"use strict";var invariant=function(condition,format,a,b,c,d,e,f){if(false){if(format===undefined){throw new Error("invariant requires an error message argument")}}if(!condition){var error;if(format===undefined){error=new Error("Minified exception occurred; use the non-minified dev environment "+"for the full error message and additional helpful warnings.")}else{var args=[a,b,c,d,e,f];var argIndex=0;error=new Error("Invariant Violation: "+format.replace(/%s/g,function(){return args[argIndex++]}))}error.framesToPop=1;throw error}};module.exports=invariant},{}],32:[function(require,module,exports){require("fetch")},{fetch:33}],33:[function(require,module,exports){(function(){"use strict";if(window.fetch){return}function Headers(headers){this.map={};var self=this;if(headers instanceof Headers){headers.forEach(function(name,values){values.forEach(function(value){self.append(name,value)})})}else if(headers){Object.getOwnPropertyNames(headers).forEach(function(name){self.append(name,headers[name])})}}Headers.prototype.append=function(name,value){var list=this.map[name];if(!list){list=[];this.map[name]=list}list.push(value)};Headers.prototype["delete"]=function(name){delete this.map[name]};Headers.prototype.get=function(name){var values=this.map[name];return values?values[0]:null};Headers.prototype.getAll=function(name){return this.map[name]||[]};Headers.prototype.has=function(name){return this.map.hasOwnProperty(name)};Headers.prototype.set=function(name,value){this.map[name]=[value]};Headers.prototype.forEach=function(callback){var self=this;Object.getOwnPropertyNames(this.map).forEach(function(name){callback(name,self.map[name])})};function consumed(body){if(body.bodyUsed){return Promise.reject(new TypeError("Body already consumed"))}body.bodyUsed=true}function Body(){this._body=null;this.bodyUsed=false;this.arrayBuffer=function(){throw new Error("Not implemented yet")};this.blob=function(){var rejected=consumed(this);return rejected?rejected:Promise.resolve(new Blob([this._body]))};this.formData=function(){var rejected=consumed(this);return rejected?rejected:Promise.resolve(decode(this._body))};this.json=function(){var rejected=consumed(this);if(rejected){return rejected}var body=this._body;return new Promise(function(resolve,reject){try{resolve(JSON.parse(body))}catch(ex){reject(ex)}})};this.text=function(){var rejected=consumed(this);return rejected?rejected:Promise.resolve(this._body)};return this}var methods=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function normalizeMethod(method){var upcased=method.toUpperCase();return methods.indexOf(upcased)>-1?upcased:method}function Request(url,options){options=options||{};this.url=url;this._body=options.body;this.credentials=options.credentials||null;this.headers=new Headers(options.headers);this.method=normalizeMethod(options.method||"GET");this.mode=options.mode||null;this.referrer=null}function decode(body){var form=new FormData;body.trim().split("&").forEach(function(bytes){if(bytes){var split=bytes.split("=");var name=split.shift().replace(/\+/g," ");var value=split.join("=").replace(/\+/g," ");form.append(decodeURIComponent(name),decodeURIComponent(value))}});return form}function headers(xhr){var head=new Headers;var pairs=xhr.getAllResponseHeaders().trim().split("\n");pairs.forEach(function(header){var split=header.trim().split(":");var key=split.shift().trim();var value=split.join(":").trim();head.append(key,value)});return head}Request.prototype.fetch=function(){var self=this;return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.onload=function(){var status=xhr.status===1223?204:xhr.status;if(status<100||status>599){reject(new TypeError("Network request failed"));return}var options={status:status,statusText:xhr.statusText,headers:headers(xhr)};resolve(new Response(xhr.responseText,options))};xhr.onerror=function(){reject(new TypeError("Network request failed"))};xhr.open(self.method,self.url);self.headers.forEach(function(name,values){values.forEach(function(value){xhr.setRequestHeader(name,value)})});xhr.send(self._body===undefined?null:self._body)})};Body.call(Request.prototype);function Response(body,options){this._body=body;this.type="default";this.url=null;this.status=options.status;this.statusText=options.statusText;this.headers=options.headers}Body.call(Response.prototype);window.fetch=function(url,options){return new Request(url,options).fetch()}})()},{}],34:[function(require,module,exports){(function(){var root=this;var previousUnderscore=root._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype;var push=ArrayProto.push,slice=ArrayProto.slice,concat=ArrayProto.concat,toString=ObjProto.toString,hasOwnProperty=ObjProto.hasOwnProperty;
var nativeIsArray=Array.isArray,nativeKeys=Object.keys,nativeBind=FuncProto.bind;var _=function(obj){if(obj instanceof _)return obj;if(!(this instanceof _))return new _(obj);this._wrapped=obj};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=_}exports._=_}else{root._=_}_.VERSION="1.7.0";var createCallback=function(func,context,argCount){if(context===void 0)return func;switch(argCount==null?3:argCount){case 1:return function(value){return func.call(context,value)};case 2:return function(value,other){return func.call(context,value,other)};case 3:return function(value,index,collection){return func.call(context,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(context,accumulator,value,index,collection)}}return function(){return func.apply(context,arguments)}};_.iteratee=function(value,context,argCount){if(value==null)return _.identity;if(_.isFunction(value))return createCallback(value,context,argCount);if(_.isObject(value))return _.matches(value);return _.property(value)};_.each=_.forEach=function(obj,iteratee,context){if(obj==null)return obj;iteratee=createCallback(iteratee,context);var i,length=obj.length;if(length===+length){for(i=0;i<length;i++){iteratee(obj[i],i,obj)}}else{var keys=_.keys(obj);for(i=0,length=keys.length;i<length;i++){iteratee(obj[keys[i]],keys[i],obj)}}return obj};_.map=_.collect=function(obj,iteratee,context){if(obj==null)return[];iteratee=_.iteratee(iteratee,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,results=Array(length),currentKey;for(var index=0;index<length;index++){currentKey=keys?keys[index]:index;results[index]=iteratee(obj[currentKey],currentKey,obj)}return results};var reduceError="Reduce of empty array with no initial value";_.reduce=_.foldl=_.inject=function(obj,iteratee,memo,context){if(obj==null)obj=[];iteratee=createCallback(iteratee,context,4);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index=0,currentKey;if(arguments.length<3){if(!length)throw new TypeError(reduceError);memo=obj[keys?keys[index++]:index++]}for(;index<length;index++){currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo};_.reduceRight=_.foldr=function(obj,iteratee,memo,context){if(obj==null)obj=[];iteratee=createCallback(iteratee,context,4);var keys=obj.length!==+obj.length&&_.keys(obj),index=(keys||obj).length,currentKey;if(arguments.length<3){if(!index)throw new TypeError(reduceError);memo=obj[keys?keys[--index]:--index]}while(index--){currentKey=keys?keys[index]:index;memo=iteratee(memo,obj[currentKey],currentKey,obj)}return memo};_.find=_.detect=function(obj,predicate,context){var result;predicate=_.iteratee(predicate,context);_.some(obj,function(value,index,list){if(predicate(value,index,list)){result=value;return true}});return result};_.filter=_.select=function(obj,predicate,context){var results=[];if(obj==null)return results;predicate=_.iteratee(predicate,context);_.each(obj,function(value,index,list){if(predicate(value,index,list))results.push(value)});return results};_.reject=function(obj,predicate,context){return _.filter(obj,_.negate(_.iteratee(predicate)),context)};_.every=_.all=function(obj,predicate,context){if(obj==null)return true;predicate=_.iteratee(predicate,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index,currentKey;for(index=0;index<length;index++){currentKey=keys?keys[index]:index;if(!predicate(obj[currentKey],currentKey,obj))return false}return true};_.some=_.any=function(obj,predicate,context){if(obj==null)return false;predicate=_.iteratee(predicate,context);var keys=obj.length!==+obj.length&&_.keys(obj),length=(keys||obj).length,index,currentKey;for(index=0;index<length;index++){currentKey=keys?keys[index]:index;if(predicate(obj[currentKey],currentKey,obj))return true}return false};_.contains=_.include=function(obj,target){if(obj==null)return false;if(obj.length!==+obj.length)obj=_.values(obj);return _.indexOf(obj,target)>=0};_.invoke=function(obj,method){var args=slice.call(arguments,2);var isFunc=_.isFunction(method);return _.map(obj,function(value){return(isFunc?method:value[method]).apply(value,args)})};_.pluck=function(obj,key){return _.map(obj,_.property(key))};_.where=function(obj,attrs){return _.filter(obj,_.matches(attrs))};_.findWhere=function(obj,attrs){return _.find(obj,_.matches(attrs))};_.max=function(obj,iteratee,context){var result=-Infinity,lastComputed=-Infinity,value,computed;if(iteratee==null&&obj!=null){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value>result){result=value}}}else{iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed>lastComputed||computed===-Infinity&&result===-Infinity){result=value;lastComputed=computed}})}return result};_.min=function(obj,iteratee,context){var result=Infinity,lastComputed=Infinity,value,computed;if(iteratee==null&&obj!=null){obj=obj.length===+obj.length?obj:_.values(obj);for(var i=0,length=obj.length;i<length;i++){value=obj[i];if(value<result){result=value}}}else{iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index,list){computed=iteratee(value,index,list);if(computed<lastComputed||computed===Infinity&&result===Infinity){result=value;lastComputed=computed}})}return result};_.shuffle=function(obj){var set=obj&&obj.length===+obj.length?obj:_.values(obj);var length=set.length;var shuffled=Array(length);for(var index=0,rand;index<length;index++){rand=_.random(0,index);if(rand!==index)shuffled[index]=shuffled[rand];shuffled[rand]=set[index]}return shuffled};_.sample=function(obj,n,guard){if(n==null||guard){if(obj.length!==+obj.length)obj=_.values(obj);return obj[_.random(obj.length-1)]}return _.shuffle(obj).slice(0,Math.max(0,n))};_.sortBy=function(obj,iteratee,context){iteratee=_.iteratee(iteratee,context);return _.pluck(_.map(obj,function(value,index,list){return{value:value,index:index,criteria:iteratee(value,index,list)}}).sort(function(left,right){var a=left.criteria;var b=right.criteria;if(a!==b){if(a>b||a===void 0)return 1;if(a<b||b===void 0)return-1}return left.index-right.index}),"value")};var group=function(behavior){return function(obj,iteratee,context){var result={};iteratee=_.iteratee(iteratee,context);_.each(obj,function(value,index){var key=iteratee(value,index,obj);behavior(result,value,key)});return result}};_.groupBy=group(function(result,value,key){if(_.has(result,key))result[key].push(value);else result[key]=[value]});_.indexBy=group(function(result,value,key){result[key]=value});_.countBy=group(function(result,value,key){if(_.has(result,key))result[key]++;else result[key]=1});_.sortedIndex=function(array,obj,iteratee,context){iteratee=_.iteratee(iteratee,context,1);var value=iteratee(obj);var low=0,high=array.length;while(low<high){var mid=low+high>>>1;if(iteratee(array[mid])<value)low=mid+1;else high=mid}return low};_.toArray=function(obj){if(!obj)return[];if(_.isArray(obj))return slice.call(obj);if(obj.length===+obj.length)return _.map(obj,_.identity);return _.values(obj)};_.size=function(obj){if(obj==null)return 0;return obj.length===+obj.length?obj.length:_.keys(obj).length};_.partition=function(obj,predicate,context){predicate=_.iteratee(predicate,context);var pass=[],fail=[];_.each(obj,function(value,key,obj){(predicate(value,key,obj)?pass:fail).push(value)});return[pass,fail]};_.first=_.head=_.take=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[0];if(n<0)return[];return slice.call(array,0,n)};_.initial=function(array,n,guard){return slice.call(array,0,Math.max(0,array.length-(n==null||guard?1:n)))};_.last=function(array,n,guard){if(array==null)return void 0;if(n==null||guard)return array[array.length-1];return slice.call(array,Math.max(array.length-n,0))};_.rest=_.tail=_.drop=function(array,n,guard){return slice.call(array,n==null||guard?1:n)};_.compact=function(array){return _.filter(array,_.identity)};var flatten=function(input,shallow,strict,output){if(shallow&&_.every(input,_.isArray)){return concat.apply(output,input)}for(var i=0,length=input.length;i<length;i++){var value=input[i];if(!_.isArray(value)&&!_.isArguments(value)){if(!strict)output.push(value)}else if(shallow){push.apply(output,value)}else{flatten(value,shallow,strict,output)}}return output};_.flatten=function(array,shallow){return flatten(array,shallow,false,[])};_.without=function(array){return _.difference(array,slice.call(arguments,1))};_.uniq=_.unique=function(array,isSorted,iteratee,context){if(array==null)return[];if(!_.isBoolean(isSorted)){context=iteratee;iteratee=isSorted;isSorted=false}if(iteratee!=null)iteratee=_.iteratee(iteratee,context);var result=[];var seen=[];for(var i=0,length=array.length;i<length;i++){var value=array[i];if(isSorted){if(!i||seen!==value)result.push(value);seen=value}else if(iteratee){var computed=iteratee(value,i,array);if(_.indexOf(seen,computed)<0){seen.push(computed);result.push(value)}}else if(_.indexOf(result,value)<0){result.push(value)}}return result};_.union=function(){return _.uniq(flatten(arguments,true,true,[]))};_.intersection=function(array){if(array==null)return[];var result=[];var argsLength=arguments.length;for(var i=0,length=array.length;i<length;i++){var item=array[i];if(_.contains(result,item))continue;for(var j=1;j<argsLength;j++){if(!_.contains(arguments[j],item))break}if(j===argsLength)result.push(item)}return result};_.difference=function(array){var rest=flatten(slice.call(arguments,1),true,true,[]);return _.filter(array,function(value){return!_.contains(rest,value)})};_.zip=function(array){if(array==null)return[];var length=_.max(arguments,"length").length;var results=Array(length);for(var i=0;i<length;i++){results[i]=_.pluck(arguments,i)}return results};_.object=function(list,values){if(list==null)return{};var result={};for(var i=0,length=list.length;i<length;i++){if(values){result[list[i]]=values[i]}else{result[list[i][0]]=list[i][1]}}return result};_.indexOf=function(array,item,isSorted){if(array==null)return-1;var i=0,length=array.length;if(isSorted){if(typeof isSorted=="number"){i=isSorted<0?Math.max(0,length+isSorted):isSorted}else{i=_.sortedIndex(array,item);return array[i]===item?i:-1}}for(;i<length;i++)if(array[i]===item)return i;return-1};_.lastIndexOf=function(array,item,from){if(array==null)return-1;var idx=array.length;if(typeof from=="number"){idx=from<0?idx+from+1:Math.min(idx,from+1)}while(--idx>=0)if(array[idx]===item)return idx;return-1};_.range=function(start,stop,step){if(arguments.length<=1){stop=start||0;start=0}step=step||1;var length=Math.max(Math.ceil((stop-start)/step),0);var range=Array(length);for(var idx=0;idx<length;idx++,start+=step){range[idx]=start}return range};var Ctor=function(){};_.bind=function(func,context){var args,bound;if(nativeBind&&func.bind===nativeBind)return nativeBind.apply(func,slice.call(arguments,1));if(!_.isFunction(func))throw new TypeError("Bind must be called on a function");args=slice.call(arguments,2);bound=function(){if(!(this instanceof bound))return func.apply(context,args.concat(slice.call(arguments)));Ctor.prototype=func.prototype;var self=new Ctor;Ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(_.isObject(result))return result;return self};return bound};_.partial=function(func){var boundArgs=slice.call(arguments,1);return function(){var position=0;var args=boundArgs.slice();for(var i=0,length=args.length;i<length;i++){if(args[i]===_)args[i]=arguments[position++]}while(position<arguments.length)args.push(arguments[position++]);return func.apply(this,args)}};_.bindAll=function(obj){var i,length=arguments.length,key;if(length<=1)throw new Error("bindAll must be passed function names");for(i=1;i<length;i++){key=arguments[i];obj[key]=_.bind(obj[key],obj)}return obj};_.memoize=function(func,hasher){var memoize=function(key){var cache=memoize.cache;var address=hasher?hasher.apply(this,arguments):key;if(!_.has(cache,address))cache[address]=func.apply(this,arguments);return cache[address]};memoize.cache={};return memoize};_.delay=function(func,wait){var args=slice.call(arguments,2);return setTimeout(function(){return func.apply(null,args)},wait)};_.defer=function(func){return _.delay.apply(_,[func,1].concat(slice.call(arguments,1)))};_.throttle=function(func,wait,options){var context,args,result;var timeout=null;var previous=0;if(!options)options={};var later=function(){previous=options.leading===false?0:_.now();timeout=null;result=func.apply(context,args);if(!timeout)context=args=null};return function(){var now=_.now();if(!previous&&options.leading===false)previous=now;var remaining=wait-(now-previous);context=this;args=arguments;if(remaining<=0||remaining>wait){clearTimeout(timeout);timeout=null;previous=now;result=func.apply(context,args);if(!timeout)context=args=null}else if(!timeout&&options.trailing!==false){timeout=setTimeout(later,remaining)}return result}};_.debounce=function(func,wait,immediate){var timeout,args,context,timestamp,result;var later=function(){var last=_.now()-timestamp;if(last<wait&&last>0){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);if(!timeout)context=args=null}}};return function(){context=this;args=arguments;timestamp=_.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result}};_.wrap=function(func,wrapper){return _.partial(wrapper,func)};_.negate=function(predicate){return function(){return!predicate.apply(this,arguments)}};_.compose=function(){var args=arguments;var start=args.length-1;return function(){var i=start;var result=args[start].apply(this,arguments);while(i--)result=args[i].call(this,result);return result}};_.after=function(times,func){return function(){if(--times<1){return func.apply(this,arguments)}}};_.before=function(times,func){var memo;return function(){if(--times>0){memo=func.apply(this,arguments)}else{func=null}return memo}};_.once=_.partial(_.before,2);_.keys=function(obj){if(!_.isObject(obj))return[];if(nativeKeys)return nativeKeys(obj);var keys=[];for(var key in obj)if(_.has(obj,key))keys.push(key);return keys};_.values=function(obj){var keys=_.keys(obj);var length=keys.length;var values=Array(length);for(var i=0;i<length;i++){values[i]=obj[keys[i]]}return values};_.pairs=function(obj){var keys=_.keys(obj);var length=keys.length;var pairs=Array(length);for(var i=0;i<length;i++){pairs[i]=[keys[i],obj[keys[i]]]}return pairs};_.invert=function(obj){var result={};var keys=_.keys(obj);for(var i=0,length=keys.length;i<length;i++){result[obj[keys[i]]]=keys[i]}return result};_.functions=_.methods=function(obj){var names=[];for(var key in obj){if(_.isFunction(obj[key]))names.push(key)}return names.sort()};_.extend=function(obj){if(!_.isObject(obj))return obj;var source,prop;for(var i=1,length=arguments.length;i<length;i++){source=arguments[i];for(prop in source){if(hasOwnProperty.call(source,prop)){obj[prop]=source[prop]}}}return obj};_.pick=function(obj,iteratee,context){var result={},key;if(obj==null)return result;if(_.isFunction(iteratee)){iteratee=createCallback(iteratee,context);for(key in obj){var value=obj[key];if(iteratee(value,key,obj))result[key]=value}}else{var keys=concat.apply([],slice.call(arguments,1));obj=new Object(obj);for(var i=0,length=keys.length;i<length;i++){key=keys[i];if(key in obj)result[key]=obj[key]}}return result};_.omit=function(obj,iteratee,context){if(_.isFunction(iteratee)){iteratee=_.negate(iteratee)}else{var keys=_.map(concat.apply([],slice.call(arguments,1)),String);iteratee=function(value,key){return!_.contains(keys,key)}}return _.pick(obj,iteratee,context)};_.defaults=function(obj){if(!_.isObject(obj))return obj;for(var i=1,length=arguments.length;i<length;i++){var source=arguments[i];for(var prop in source){if(obj[prop]===void 0)obj[prop]=source[prop]}}return obj};_.clone=function(obj){if(!_.isObject(obj))return obj;return _.isArray(obj)?obj.slice():_.extend({},obj)};_.tap=function(obj,interceptor){interceptor(obj);return obj};var eq=function(a,b,aStack,bStack){if(a===b)return a!==0||1/a===1/b;if(a==null||b==null)return a===b;if(a instanceof _)a=a._wrapped;if(b instanceof _)b=b._wrapped;var className=toString.call(a);if(className!==toString.call(b))return false;switch(className){case"[object RegExp]":case"[object String]":return""+a===""+b;case"[object Number]":if(+a!==+a)return+b!==+b;return+a===0?1/+a===1/b:+a===+b;case"[object Date]":case"[object Boolean]":return+a===+b}if(typeof a!="object"||typeof b!="object")return false;var length=aStack.length;while(length--){if(aStack[length]===a)return bStack[length]===b}var aCtor=a.constructor,bCtor=b.constructor;if(aCtor!==bCtor&&"constructor"in a&&"constructor"in b&&!(_.isFunction(aCtor)&&aCtor instanceof aCtor&&_.isFunction(bCtor)&&bCtor instanceof bCtor)){return false}aStack.push(a);bStack.push(b);var size,result;if(className==="[object Array]"){size=a.length;result=size===b.length;if(result){while(size--){if(!(result=eq(a[size],b[size],aStack,bStack)))break}}}else{var keys=_.keys(a),key;size=keys.length;result=_.keys(b).length===size;if(result){while(size--){key=keys[size];if(!(result=_.has(b,key)&&eq(a[key],b[key],aStack,bStack)))break}}}aStack.pop();bStack.pop();return result};_.isEqual=function(a,b){return eq(a,b,[],[])};_.isEmpty=function(obj){if(obj==null)return true;if(_.isArray(obj)||_.isString(obj)||_.isArguments(obj))return obj.length===0;for(var key in obj)if(_.has(obj,key))return false;return true};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isObject=function(obj){var type=typeof obj;return type==="function"||type==="object"&&!!obj};_.each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)==="[object "+name+"]"}});if(!_.isArguments(arguments)){_.isArguments=function(obj){return _.has(obj,"callee")}}if(typeof/./!=="function"){_.isFunction=function(obj){return typeof obj=="function"||false}}_.isFinite=function(obj){return isFinite(obj)&&!isNaN(parseFloat(obj))};_.isNaN=function(obj){return _.isNumber(obj)&&obj!==+obj};_.isBoolean=function(obj){return obj===true||obj===false||toString.call(obj)==="[object Boolean]"};_.isNull=function(obj){return obj===null};_.isUndefined=function(obj){return obj===void 0};_.has=function(obj,key){return obj!=null&&hasOwnProperty.call(obj,key)};_.noConflict=function(){root._=previousUnderscore;return this};_.identity=function(value){return value};_.constant=function(value){return function(){return value}};_.noop=function(){};_.property=function(key){return function(obj){return obj[key]}};_.matches=function(attrs){var pairs=_.pairs(attrs),length=pairs.length;return function(obj){if(obj==null)return!length;obj=new Object(obj);for(var i=0;i<length;i++){var pair=pairs[i],key=pair[0];if(pair[1]!==obj[key]||!(key in obj))return false}return true}};_.times=function(n,iteratee,context){var accum=Array(Math.max(0,n));iteratee=createCallback(iteratee,context,1);for(var i=0;i<n;i++)accum[i]=iteratee(i);return accum};_.random=function(min,max){if(max==null){max=min;min=0}return min+Math.floor(Math.random()*(max-min+1))};_.now=Date.now||function(){return(new Date).getTime()};var escapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var unescapeMap=_.invert(escapeMap);var createEscaper=function(map){var escaper=function(match){return map[match]};var source="(?:"+_.keys(map).join("|")+")";var testRegexp=RegExp(source);var replaceRegexp=RegExp(source,"g");return function(string){string=string==null?"":""+string;return testRegexp.test(string)?string.replace(replaceRegexp,escaper):string}};_.escape=createEscaper(escapeMap);_.unescape=createEscaper(unescapeMap);_.result=function(object,property){if(object==null)return void 0;var value=object[property];return _.isFunction(value)?object[property]():value};var idCounter=0;_.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id};_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var noMatch=/(.)^/;var escapes={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"};var escaper=/\\|'|\r|\n|\u2028|\u2029/g;var escapeChar=function(match){return"\\"+escapes[match]};_.template=function(text,settings,oldSettings){if(!settings&&oldSettings)settings=oldSettings;settings=_.defaults({},settings,_.templateSettings);var matcher=RegExp([(settings.escape||noMatch).source,(settings.interpolate||noMatch).source,(settings.evaluate||noMatch).source].join("|")+"|$","g");var index=0;var source="__p+='";text.replace(matcher,function(match,escape,interpolate,evaluate,offset){source+=text.slice(index,offset).replace(escaper,escapeChar);index=offset+match.length;if(escape){source+="'+\n((__t=("+escape+"))==null?'':_.escape(__t))+\n'"}else if(interpolate){source+="'+\n((__t=("+interpolate+"))==null?'':__t)+\n'"}else if(evaluate){source+="';\n"+evaluate+"\n__p+='"}return match});source+="';\n";if(!settings.variable)source="with(obj||{}){\n"+source+"}\n";source="var __t,__p='',__j=Array.prototype.join,"+"print=function(){__p+=__j.call(arguments,'');};\n"+source+"return __p;\n";try{var render=new Function(settings.variable||"obj","_",source)}catch(e){e.source=source;throw e}var template=function(data){return render.call(this,data,_)};var argument=settings.variable||"obj";template.source="function("+argument+"){\n"+source+"}";return template};_.chain=function(obj){var instance=_(obj);instance._chain=true;return instance};var result=function(obj){return this._chain?_(obj).chain():obj};_.mixin=function(obj){_.each(_.functions(obj),function(name){var func=_[name]=obj[name];_.prototype[name]=function(){var args=[this._wrapped];push.apply(args,arguments);return result.call(this,func.apply(_,args))}})};_.mixin(_);_.each(["pop","push","reverse","shift","sort","splice","unshift"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){var obj=this._wrapped;method.apply(obj,arguments);if((name==="shift"||name==="splice")&&obj.length===0)delete obj[0];return result.call(this,obj)}});_.each(["concat","join","slice"],function(name){var method=ArrayProto[name];_.prototype[name]=function(){return result.call(this,method.apply(this._wrapped,arguments))}});_.prototype.value=function(){return this._wrapped};if(typeof define==="function"&&define.amd){define("underscore",[],function(){return _})}}).call(this)},{}]},{},[])("./index.js")});